(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{368:function(e,t,a){"use strict";a.r(t);var s=a(6),n=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("One of my goals with "),t("a",{attrs:{href:"https://chevere.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("Chevere"),t("OutboundLink")],1),e._v(" was to learn more about problem-solving approaches and the culture that comes with them. I achieved this by exploring various software, starting with CI tools and continuing through to esoteric software practices. Among all the tools I encountered, "),t("a",{attrs:{href:"https://github.com/features/actions",target:"_blank",rel:"noopener noreferrer"}},[e._v("GitHub Actions"),t("OutboundLink")],1),e._v(" caught my attention the most. It allows you to declare interconnected jobs and use actions published by third parties to stay productive. What interested me the most was the "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/Workflow_pattern",target:"_blank",rel:"noopener noreferrer"}},[e._v("workflow pattern"),t("OutboundLink")],1),e._v(", which inspired me to create the "),t("a",{attrs:{href:"https://chevere.org/packages/workflow",target:"_blank",rel:"noopener noreferrer"}},[e._v("Workflow package"),t("OutboundLink")],1),e._v(" for Chevere.")]),e._v(" "),t("h2",{attrs:{id:"technical-debt"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#technical-debt"}},[e._v("#")]),e._v(" Technical debt")]),e._v(" "),t("p",[e._v("When I have to produce a new system, I try to keep it neat and clean. To achieve this, I use "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/Test-driven_development",target:"_blank",rel:"noopener noreferrer"}},[e._v("TDD"),t("OutboundLink")],1),e._v(", ensure a good code coverage threshold, and aim for high "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/Mutation_testing",target:"_blank",rel:"noopener noreferrer"}},[e._v("MSI"),t("OutboundLink")],1),e._v(" when possible. However, this approach can be expensive and is often sacrificed in many organizations.")]),e._v(" "),t("p",[e._v("Any evolving system is prone to being patched in the MVP way, which means adding features as quickly as possible. Once done, who cares... It works, and we are making money. While the product gains features in this manner, it also accumulates "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/Technical_debt",target:"_blank",rel:"noopener noreferrer"}},[e._v("technical debt"),t("OutboundLink")],1),e._v(". This happens in any project as teams change, people bring different approaches, technology evolves, and the only person who knows the system is now 90 years old, etc.")]),e._v(" "),t("p",[e._v("At some point, it will become expensive to go in any direction, whether it is to maintain, change, or replace the system.")]),e._v(" "),t("h2",{attrs:{id:"predict-the-unknown"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#predict-the-unknown"}},[e._v("#")]),e._v(" Predict the unknown")]),e._v(" "),t("p",[e._v("I can abstract predictable needs, but many aspects are too uncertain and potential candidates for a re-factoring loop as they evolve. I realized that my code went wrong when new business rules kept being added for a long period (4 years in a row). You know how it goes; you struggle in a loop to find the solution for a known problem that will keep changing over time.")]),e._v(" "),t("p",[e._v("I noticed that my mess was caused by the combination of adding more features while altering permissions and not extensively testing them. I first tried with plug-in strategies and noticed that my business logic was getting sparse as I was pushing beyond what a plug-in system is meant for.")]),e._v(" "),t("p",[e._v("To easily maintain the business, it requires abstracting everything into modules that can be plugged into each other.")]),e._v(" "),t("h2",{attrs:{id:"here-be-workflows"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#here-be-workflows"}},[e._v("#")]),e._v(" Here be Workflows!")]),e._v(" "),t("p",[e._v('A Workflow allows you to define a procedure consisting of a series of interconnected independent jobs. With workflows, you focus on the job units that define the process to solve the problem, rather than abstracting "the problem".')]),e._v(" "),t("p",[e._v("âœ¨ Think about it as Lego, but instead of bricks, we use "),t("strong",[e._v("Jobs")]),e._v(" which are made from templates called "),t("strong",[e._v("Actions")]),e._v(".")]),e._v(" "),t("p",[e._v("A workflow-based approach has several advantages:")]),e._v(" "),t("ul",[t("li",[e._v("Actions are reusable.")]),e._v(" "),t("li",[e._v('Testing becomes lighter on the Workflow ("the problem").')]),e._v(" "),t("li",[e._v("Easy to rearrange jobs and their dependencies.")]),e._v(" "),t("li",[e._v("Room for endless additions.")])]),e._v(" "),t("p",[t("strong",[e._v("Challenges")]),e._v(":")]),e._v(" "),t("ul",[t("li",[e._v("Async (parallel) execution in PHP.")]),e._v(" "),t("li",[e._v("Validating definitions.")]),e._v(" "),t("li",[e._v("Run-if conditions.")])]),e._v(" "),t("h2",{attrs:{id:"chevere-workflow"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chevere-workflow"}},[e._v("#")]),e._v(" Chevere Workflow")]),e._v(" "),t("p",[e._v("The "),t("a",{attrs:{href:"https://chevere.org/packages/workflow",target:"_blank",rel:"noopener noreferrer"}},[e._v("Workflow package"),t("OutboundLink")],1),e._v(" provides management for complex workflow declarations. This post is a glorified ad for my package, "),t("em",[e._v("pretends to be shocked!")]),e._v(" as I believe using the workflow pattern can solve a ton of problems.")]),e._v(" "),t("h3",{attrs:{id:"superb-syntax"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#superb-syntax"}},[e._v("#")]),e._v(" Superb syntax")]),e._v(" "),t("p",[e._v("The most important aspect of Workflow is the end-user experience. It's all about enabling easy solutions to progressive problems, and its syntax reflects this motto.")]),e._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("use")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[e._v("Chevere"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("Workflow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("job")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("use")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[e._v("Chevere"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("Workflow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("reference")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("use")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[e._v("Chevere"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("Workflow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("variable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("use")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[e._v("Chevere"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("Workflow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("workflow")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("workflow")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token argument-name"}},[e._v("prepare")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("job")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("PrepareTweet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token argument-name"}},[e._v("message")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("variable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[e._v("'message'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token argument-name"}},[e._v("url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("variable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[e._v("'url'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token argument-name"}},[e._v("send")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("job")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("SendTweet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token argument-name"}},[e._v("payload")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("reference")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[e._v("'prepare'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[e._v("'payload'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("h3",{attrs:{id:"actions"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#actions"}},[e._v("#")]),e._v(" Actions")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://chevere.org/packages/action",target:"_blank",rel:"noopener noreferrer"}},[e._v("Actions"),t("OutboundLink")],1),e._v(" contain the logic for Workflow jobs and are responsible for declaring the "),t("code",[e._v("main()")]),e._v(" method and its expected response parameters. Actions can be "),t("em",[e._v("anything")]),e._v(", although my recommendation is to keep actions as minimal as possible.")]),e._v(" "),t("p",[e._v("Don't hesitate to split a process into four, twelve, or more job-actions. That's the point! The more you "),t("em",[e._v("unitize")]),e._v(" the procedures, the easier it gets to maintain and keep all moving parts willing to move.")]),e._v(" "),t("h3",{attrs:{id:"variables-references"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#variables-references"}},[e._v("#")]),e._v(" Variables & References")]),e._v(" "),t("p",[e._v("It uses "),t("code",[e._v("variable('var')")]),e._v(" for declaring Workflow variables that must be passed by the Workflow runner. It uses "),t("code",[e._v("reference('job', 'key')")]),e._v(" to reference previous jobs' response keys.")]),e._v(" "),t("p",[e._v("Variables "),t("code",[e._v("variable('message')")]),e._v(" and "),t("code",[e._v("variable('url')")]),e._v(" are Workflow variables, while "),t("code",[e._v("reference('prepare', 'payload')")]),e._v(" is a Job response reference. Job "),t("code",[e._v("send")]),e._v(" needs a payload parameter, which passes "),t("code",[e._v("reference('prepare', 'payload')")]),e._v(". This job implicitly declares that it depends on the "),t("code",[e._v("prepare")]),e._v(" Job and will always run after "),t("code",[e._v("prepare")]),e._v(".")]),e._v(" "),t("h3",{attrs:{id:"dependencies"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dependencies"}},[e._v("#")]),e._v(" Dependencies")]),e._v(" "),t("p",[e._v("Workflow supports explicitly declared job dependencies using the "),t("code",[e._v("withDepends")]),e._v(" method. A job won't run until its previous job dependencies are resolved, and it determines a dependency graph for this purpose.")]),e._v(" "),t("h3",{attrs:{id:"async"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#async"}},[e._v("#")]),e._v(" Async")]),e._v(" "),t("p",[e._v("Workflow uses "),t("a",{attrs:{href:"https://amphp.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("amphp"),t("OutboundLink")],1),e._v(" to handle parallel processing. This is "),t("em",[e._v("true parallel processing")]),e._v(" using multiple processes or native threads, without blocking.")]),e._v(" "),t("p",[e._v("Jobs run async by default if no dependencies are declared (either implicit or explicit).")]),e._v(" "),t("h3",{attrs:{id:"strict"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#strict"}},[e._v("#")]),e._v(" Strict")]),e._v(" "),t("p",[e._v("Workflow gets validated against the complete declaration, and Job references must be compatible with each other. Job declarations must match the Action binding, and Jobs' variables and reference parameters are asserted for matching.")]),e._v(" "),t("h3",{attrs:{id:"extensible"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#extensible"}},[e._v("#")]),e._v(" Extensible")]),e._v(" "),t("p",[e._v("Workflows can grow wildly under many strategies. For example, using a base Workflow for common functionality, packing related Actions in packages, adding a plugin layer to enable users to add their own extra Job, etc.")]),e._v(" "),t("h2",{attrs:{id:"feedback"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#feedback"}},[e._v("#")]),e._v(" Feedback")]),e._v(" "),t("p",[e._v("By the time I'm writing this, the Workflow package is in early preview ("),t("code",[e._v("0.8")]),e._v(") and is missing essential features like conditional job syntax. You are welcome to contribute and provide feedback at "),t("a",{attrs:{href:"https://github.com/chevere/workflow",target:"_blank",rel:"noopener noreferrer"}},[e._v("chevere/workflow"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[e._v("I hope this problem-solving approach can help you tackle your problems in a cheaper and more maintainable manner.")])])}),[],!1,null,null,null);t.default=n.exports}}]);